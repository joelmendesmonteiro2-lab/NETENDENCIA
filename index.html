<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NETENDENCIA - Controle de Depend√™ncia de Internet</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* SEU CSS COMPLETO PERMANECE EXATAMENTE O MESMO */
        :root {
            --primary-color: #4a6baf;
            --secondary-color: #f0f4f8;
            --accent-color: #4a6baf;
            --text-color: #333;
            --light-text: #666;
            --border-color: #ddd;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --dependente-color: #ff6b6b;
            --moderado-color: #ffa726;
            --nao-dependente-color: #4caf50;
            --success-color: #28a745;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), #6a8bcf);
            border-radius: 12px;
            color: white;
            box-shadow: var(--card-shadow);
            position: relative;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }
        
        h2 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        h2 i {
            margin-right: 10px;
        }
        
        .welcome {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            text-align: center;
            border-left: 5px solid var(--primary-color);
        }
        
        .welcome h2 {
            margin-bottom: 10px;
            justify-content: center;
        }
        
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, var(--border-color), transparent);
            margin: 25px 0;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .card {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.12);
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            margin-top: 15px;
            transition: var(--transition);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            background-color: #3a5a9f;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #4a6baf;
        }

        .btn-success {
            background-color: var(--success-color);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-exit {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .btn-exit:hover {
            background-color: #3a5a9f;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.25);
        }
        
        .tips-container {
            margin-bottom: 30px;
        }
        
        .carousel-container {
            position: relative;
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            border-top: 5px solid var(--accent-color);
            overflow: hidden;
        }
        
        .chart-container {
            background-color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            margin-bottom: 25px;
            border-top: 5px solid #4a6baf;
        }
        
        .chart {
            height: 300px;
            background: #f9f9f9;
            border-radius: 8px;
            margin-top: 20px;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border: 2px dashed #ddd;
        }
        
        .chart-placeholder {
            color: #999;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .tips-blank {
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-style: italic;
            background: #f9f9f9;
            border-radius: 8px;
            margin: 20px 0;
            border: 2px dashed #ddd;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: var(--light-text);
            font-size: 0.9rem;
            padding: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            margin-right: 10px;
            background-size: contain;
            background-repeat: no-repeat;
            vertical-align: middle;
        }
        
        .icon-progress { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%234a6baf"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>'); }
        .icon-question { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%234a6baf"><path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/></svg>'); }
        .icon-tips { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23ff6b6b"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>'); }
        .icon-chart { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%234CAF50"><path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"/></svg>'); }
        .icon-exit { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white"><path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/></svg>'); }
        .icon-family { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%234a6baf"><path d="M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zm4 18v-6h2.5l-2.54-7.63A2.01 2.01 0 0018.06 7h-2.12c-.93 0-1.76.53-2.18 1.37L12.5 13.6 11.22 10c-.48-1.06-1.54-1.8-2.72-1.8H4c-1.1 0-2 .9-2 2v6h2v6h4v-6h2v6h4v-6h2v6h4v-6h2v6h4v-6zm-7-7.5V9c0-1.1.9-2 2-2h2c1.1 0 2 .9 2 2v5.5c0 .83-.67 1.5-1.5 1.5h-3c-.83 0-1.5-.67-1.5-1.5z"/></svg>'); }
        .icon-institution { background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2328a745"><path d="M12 7V3L2 9l10 6 10-6-10-6zM2 9l10 6 10-6M2 15l10 6 10-6M2 21l10 6 10-6"/></svg>'); }
        
        /* Novos estilos */
        .user-profile {
            margin-bottom: 25px;
        }
        
        .profile-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .profile-item {
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }
        
        .profile-item strong {
            display: block;
            color: var(--light-text);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .nivel {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .nivel.dependente {
            background-color: var(--dependente-color);
            color: white;
        }
        
        .nivel.moderado {
            background-color: var(--moderado-color);
            color: white;
        }
        
        .nivel.nao-dependente {
            background-color: var(--nao-dependente-color);
            color: white;
        }
        
        .family-container {
            margin-bottom: 25px;
        }
        
        .family-members {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .family-member {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
            position: relative;
        }
        
        .family-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            display: block;
        }
        
        .stat-label {
            font-size: 0.8rem;
            opacity: 0.9;
        }
        
        .reavaliacao-alerta {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        /* Modal do question√°rio */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
        }

        .modal-content-large {
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .pergunta {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .pergunta-texto {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text-color);
        }
        
        .opcoes-resposta {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .opcao {
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .opcao:hover {
            border-color: var(--primary-color);
            background: #f0f4f8;
        }
        
        .opcao.selecionada {
            border-color: var(--primary-color);
            background: var(--primary-color);
            color: white;
        }
        
        .solucoes-list {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--accent-color);
        }
        
        .solucao-item {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .solucao-item:last-child {
            border-bottom: none;
        }
        
        /* Centro de Recursos */
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .resource-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            cursor: pointer;
            border-left: 4px solid var(--primary-color);
        }
        
        .resource-card:hover {
            transform: translateY(-5px);
        }
        
        .resource-card h4 {
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .resource-card p {
            color: var(--light-text);
            font-size: 0.9rem;
        }
        
        /* ESTILOS CORRIGIDOS PARA PLANO DE A√á√ÉO */
        .action-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .action-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .action-item.completed {
            background: #d4edda;
            border-left-color: var(--success-color);
            text-decoration: line-through;
            opacity: 0.8;
        }

        .action-item input[type="checkbox"] {
            margin-right: 12px;
            transform: scale(1.2);
        }

        .action-item label {
            flex: 1;
            margin: 0;
            cursor: pointer;
        }

        .plano-stats {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
        }

        .plano-stat {
            text-align: center;
        }

        .plano-stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            display: block;
        }

        .plano-stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .reflection-question {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .reflection-question label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .reflection-question textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: vertical;
            min-height: 80px;
        }
        
        /* Bot√£o de excluir membro */
        .btn-excluir {
            background-color: #ff6b6b;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            margin-top: 8px;
            transition: var(--transition);
        }
        
        .btn-excluir:hover {
            background-color: #ff5252;
            transform: translateY(-1px);
        }

        /* Bot√£o de question√°rio para membros */
        .btn-questionario {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 0.7rem;
            cursor: pointer;
            margin-top: 8px;
            margin-right: 5px;
            transition: var(--transition);
        }
        
        .btn-questionario:hover {
            background-color: #3a5a9f;
            transform: translateY(-1px);
        }
        
        .sem-diagnostico {
            color: #999;
            font-style: italic;
            font-size: 0.8rem;
            margin-top: 5px;
        }

        .botoes-membro {
            display: flex;
            gap: 5px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        /* Estilos para o modal de institui√ß√µes */
        .instituicoes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .instituicao-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            border-left: 4px solid var(--success-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .instituicao-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .instituicao-nome {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .profissional-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            margin: 0.5rem 0;
            border-left: 3px solid var(--success-color);
        }

        .profissional-nome {
            font-weight: bold;
            color: #333;
        }

        .profissao {
            color: #666;
            font-style: italic;
        }

        .instituicao-info {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
        }

        .info-item {
            display: flex;
            align-items: center;
            margin: 0.3rem 0;
            color: #555;
        }

        .info-item i {
            margin-right: 0.5rem;
            width: 20px;
            text-align: center;
        }

        .sem-instituicoes {
            text-align: center;
            padding: 3rem;
            color: #666;
            font-style: italic;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #ddd;
            grid-column: 1 / -1;
        }

        /* Loading e Estados */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .btn-exit {
                position: relative;
                top: auto;
                right: auto;
                margin: 10px auto;
                display: flex;
                justify-content: center;
            }
            
            .modal-content {
                margin: 20px;
                padding: 20px;
            }

            .modal-content-large {
                margin: 10px;
                padding: 15px;
            }
            
            .family-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .resources-grid {
                grid-template-columns: 1fr;
            }

            .botoes-membro {
                flex-direction: column;
            }

            .instituicoes-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- SEU HTML COMPLETO PERMANECE EXATAMENTE O MESMO -->
    <header>
        <h1>NETENDENCIA</h1>
        <p>Controle sua depend√™ncia de internet, recupere sua vida</p>
        <button class="btn-exit" id="exitBtn">
            <span class="icon icon-exit"></span>
            Sair
        </button>
    </header>
    
    <section class="welcome">
        <h2><span class="icon icon-progress"></span>Ol√°, <span id="userName">Usu√°rio</span>!</h2>
        <p>Bem-vindo de volta √† sua jornada rumo ao equil√≠brio digital</p>
    </section>
    
    <!-- Perfil do Usu√°rio -->
    <section class="user-profile">
        <div class="card">
            <h2><span class="icon icon-progress"></span>Seu Perfil</h2>
            <div class="profile-info" id="profileInfo">
                <!-- Preenchido via JavaScript -->
            </div>
        </div>
    </section>
    
    <div class="divider"></div>
    
    <!-- DASHBOARD CORRIGIDO: Resumo Familiar dentro da Avalia√ß√£o Di√°ria -->
    <div class="dashboard">
        <section class="card">
            <h2><span class="icon icon-question"></span>Avalia√ß√£o Di√°ria</h2>
            <p>Responda ao question√°rio di√°rio para acompanhar seu progresso e receber feedback personalizado.</p>
            <button class="btn" id="startQuiz">Iniciar Question√°rio</button>
            <!-- BOT√ÉO CORRIGIDO - INSTITUI√á√ïES DE APOIO -->
            <button class="btn btn-success" id="btnInstituicoes" style="margin-top: 10px;">
                <span class="icon icon-institution"></span>Institui√ß√µes de Apoio e Profissionais
            </button>
            
            <!-- RESUMO FAMILIAR AGORA DENTRO DA AVALIA√á√ÉO DI√ÅRIA -->
            <div style="margin-top: 30px; padding-top: 25px; border-top: 1px solid var(--border-color);">
                <h2><span class="icon icon-family"></span>Resumo Familiar</h2>
                <div id="familySummary">
                    <!-- Preenchido via JavaScript -->
                </div>
                <button class="btn" id="addFamilyMember" style="margin-top: 15px;">+ Adicionar Membro</button>
            </div>
        </section>
    </div>
    
    <!-- CENTRO DE RECURSOS CORRIGIDO: Removido o quadro "Panorama da Fam√≠lia" -->
    <section class="card">
        <h2><span class="icon icon-tips"></span>Centro de Recursos</h2>
        <div class="resources-grid">
            <div class="resource-card" onclick="abrirDicasPersonalizadas()">
                <h4>üí° Dicas Personalizadas</h4>
                <p>Sugest√µes para melhorar seu bem-estar digital baseadas no seu √∫ltimo diagn√≥stico</p>
            </div>
            
            <div class="resource-card" onclick="abrirPlanoAcao()">
                <h4>‚úÖ Plano de A√ß√£o Pessoal</h4>
                <p>Crie e acompanhe seu plano personalizado para melhorar seu bem-estar digital</p>
            </div>
            
            <!-- REMOVIDO: Quadro Panorama da Fam√≠lia -->
            
            <!-- AUTOAVALIA√á√ÉO AGORA AQUI, NO LUGAR DO PANORAMA DA FAM√çLIA -->
            <div class="resource-card" onclick="abrirAutoavaliacao()">
                <h4>üìù Autoavalia√ß√£o e Reflex√£o</h4>
                <p>Reflita sobre seu uso digital e como voc√™ se sente em rela√ß√£o a ele</p>
            </div>
        </div>
    </section>
    
    <section class="chart-container">
        <h2><span class="icon icon-chart"></span>Seu Progresso</h2>
        <p>Evolu√ß√£o do seu controle do tempo de tela</p>
        <div class="chart" id="progressChart">
            <canvas id="chartCanvas"></canvas>
        </div>
    </section>
    
    <footer>
        <p>NETNDENCIA - Sua jornada para uma vida digital equilibrada</p>
        <p>¬© 2025 - Todos os direitos reservados</p>
    </footer>

    <!-- Modal do Question√°rio -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeModal">&times;</span>
            <h2>Question√°rio de Depend√™ncia Digital</h2>
            <p>Responda com sinceridade para obter um diagn√≥stico preciso.</p>
            
            <div id="quizQuestions">
                <!-- Perguntas ser√£o inseridas aqui via JavaScript -->
            </div>
            
            <button class="btn" id="submitQuiz" style="display: none;">Enviar Respostas</button>
            <div id="quizResult" style="display: none;">
                <!-- Resultado ser√° mostrado aqui -->
            </div>
        </div>
    </div>

    <!-- Modal do Question√°rio Familiar -->
    <div id="familyQuizModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeFamilyQuizModal">&times;</span>
            <h2 id="familyQuizTitle">Question√°rio para Membro da Fam√≠lia</h2>
            <p id="familyQuizDescription">Responda com sinceridade para obter um diagn√≥stico preciso.</p>
            
            <div id="familyQuizQuestions">
                <!-- Perguntas ser√£o inseridas aqui via JavaScript -->
            </div>
            
            <button class="btn" id="submitFamilyQuiz" style="display: none;">Enviar Respostas</button>
            <div id="familyQuizResult" style="display: none;">
                <!-- Resultado ser√° mostrado aqui -->
            </div>
        </div>
    </div>

    <!-- Modal Adicionar Membro da Fam√≠lia -->
    <div id="familyModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeFamilyModal">&times;</span>
            <h2>Adicionar Membro da Fam√≠lia</h2>
            <form id="familyForm">
                <div style="margin-bottom: 15px;">
                    <label for="memberName">Nome:</label>
                    <input type="text" id="memberName" required style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="memberAge">Idade:</label>
                    <input type="number" id="memberAge" required style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="memberRelationship">Relacionamento:</label>
                    <select id="memberRelationship" required style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Selecione...</option>
                        <option value="pai">Pai</option>
                        <option value="mae">M√£e</option>
                        <option value="filho">Filho(a)</option>
                        <option value="irmao">Irm√£o(√£)</option>
                        <option value="conjuge">C√¥njuge</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
                <button type="button" class="btn" onclick="adicionarMembroFamilia()">Adicionar Membro</button>
            </form>
        </div>
    </div>

    <!-- Modal Centro de Recursos -->
    <div id="resourcesModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close-modal" id="closeResourcesModal">&times;</span>
            <div id="resourcesContent">
                <!-- Conte√∫do dos recursos ser√° carregado aqui -->
            </div>
        </div>
    </div>

    <!-- MODAL CORRIGIDO: Institui√ß√µes de Apoio -->
    <div id="instituicoesModal" class="modal">
        <div class="modal-content modal-content-large">
            <span class="close-modal" id="closeInstituicoesModal">&times;</span>
            <h2><span class="icon icon-institution"></span>Institui√ß√µes de Apoio e Profissionais</h2>
            <p>Encontre institui√ß√µes e profissionais especializados em sa√∫de mental e depend√™ncia digital:</p>
            <div id="instituicoesAlert"></div>
            <div id="instituicoesLista" class="instituicoes-grid">
                <!-- As institui√ß√µes ser√£o carregadas aqui dinamicamente -->
            </div>
        </div>
    </div>

    <script>
        // Vari√°veis globais
        let respostasAtuais = {};
        let chartInstance = null;
        let currentResource = '';
        let currentMembroId = null;
        let currentMembroNome = '';
        let perguntasCarregadas = [];

        document.addEventListener('DOMContentLoaded', function() {
            // Carregar dados iniciais
            carregarDadosIniciais();
            
            // Bot√£o de question√°rio - CORRIGIDO
            document.getElementById('startQuiz').addEventListener('click', function() {
                abrirQuestionario();
            });
            
            // BOT√ÉO CORRIGIDO: Institui√ß√µes de Apoio
            document.getElementById('btnInstituicoes').addEventListener('click', function() {
                abrirInstituicoes();
            });
            
            // Bot√£o de adicionar membro da fam√≠lia - AGORA DENTRO DO CARD DE AVALIA√á√ÉO
            document.getElementById('addFamilyMember').addEventListener('click', function() {
                document.getElementById('familyModal').style.display = 'block';
            });
            
            // Bot√£o de sair
            document.getElementById('exitBtn').addEventListener('click', function() {
                if(confirm('Tem certeza que deseja sair?')) {
                    window.location.href = '/logout';
                }
            });
            
            // Fechar modais
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('quizModal').style.display = 'none';
            });
            
            document.getElementById('closeFamilyQuizModal').addEventListener('click', function() {
                document.getElementById('familyQuizModal').style.display = 'none';
            });
            
            document.getElementById('closeFamilyModal').addEventListener('click', function() {
                document.getElementById('familyModal').style.display = 'none';
            });
            
            document.getElementById('closeResourcesModal').addEventListener('click', function() {
                document.getElementById('resourcesModal').style.display = 'none';
            });
            
            // MODAL CORRIGIDO: Fechar modal de institui√ß√µes
            document.getElementById('closeInstituicoesModal').addEventListener('click', function() {
                document.getElementById('instituicoesModal').style.display = 'none';
            });
            
            // Enviar question√°rio - CORRIGIDO
            document.getElementById('submitQuiz').addEventListener('click', function() {
                enviarQuestionario();
            });

            // Enviar question√°rio familiar - CORRIGIDO
            document.getElementById('submitFamilyQuiz').addEventListener('click', function() {
                enviarQuestionarioFamiliar();
            });
        });

        // Fechar modais ao clicar fora
        window.addEventListener('click', function(event) {
            const modals = ['quizModal', 'familyQuizModal', 'familyModal', 'resourcesModal', 'instituicoesModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // ========== FUN√á√ïES DO SISTEMA DE QUESTION√ÅRIO ==========

        // FUN√á√ÉO CORRIGIDA: Abrir question√°rio
        async function abrirQuestionario() {
            console.log('üìù Abrindo question√°rio...');
            
            try {
                const response = await fetch('/api/perguntas');
                if (!response.ok) {
                    throw new Error('Erro ao carregar perguntas');
                }
                
                perguntasCarregadas = await response.json();
                console.log('üìã Perguntas carregadas:', perguntasCarregadas);
                
                const quizQuestions = document.getElementById('quizQuestions');
                quizQuestions.innerHTML = '';
                respostasAtuais = {};
                
                // Renderizar perguntas
                perguntasCarregadas.forEach((pergunta, index) => {
                    const perguntaDiv = document.createElement('div');
                    perguntaDiv.className = 'pergunta';
                    perguntaDiv.innerHTML = `
                        <div class="pergunta-texto">${index + 1}. ${pergunta.texto}</div>
                        <div class="opcoes-resposta" id="opcoes-${pergunta.id}">
                            ${pergunta.opcoes.map(opcao => `
                                <div class="opcao" data-pergunta="${pergunta.id}" data-opcao="${opcao.id}" data-pontuacao="${opcao.pontuacao}">
                                    ${opcao.texto}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    quizQuestions.appendChild(perguntaDiv);
                });
                
                // Adicionar eventos √†s op√ß√µes
                document.querySelectorAll('.opcao').forEach(opcao => {
                    opcao.addEventListener('click', function() {
                        const perguntaId = this.getAttribute('data-pergunta');
                        const opcaoId = this.getAttribute('data-opcao');
                        const pontuacao = parseInt(this.getAttribute('data-pontuacao'));
                        
                        // Remover sele√ß√£o anterior da mesma pergunta
                        document.querySelectorAll(`.opcao[data-pergunta="${perguntaId}"]`).forEach(op => {
                            op.classList.remove('selecionada');
                        });
                        
                        // Selecionar nova op√ß√£o
                        this.classList.add('selecionada');
                        
                        // Salvar resposta
                        respostasAtuais[perguntaId] = {
                            pergunta_id: perguntaId,
                            opcao_id: opcaoId,
                            pontuacao: pontuacao,
                            texto: this.textContent.trim()
                        };
                        
                        // Verificar se todas as perguntas foram respondidas
                        verificarRespostasCompletas();
                    });
                });
                
                document.getElementById('submitQuiz').style.display = 'none';
                document.getElementById('quizResult').style.display = 'none';
                document.getElementById('quizModal').style.display = 'block';
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar question√°rio:', error);
                alert('Erro ao carregar o question√°rio. Tente novamente.');
            }
        }

        // FUN√á√ÉO CORRIGIDA: Verificar se todas as respostas foram preenchidas
        function verificarRespostasCompletas() {
            const todasRespondidas = perguntasCarregadas.every(pergunta => 
                respostasAtuais[pergunta.id] !== undefined
            );
            
            document.getElementById('submitQuiz').style.display = todasRespondidas ? 'block' : 'none';
        }

        // FUN√á√ÉO CORRIGIDA: Enviar question√°rio
        async function enviarQuestionario() {
            console.log('üì§ Enviando question√°rio...');
            
            const respostasArray = Object.values(respostasAtuais);
            
            try {
                const response = await fetch('/api/diagnostico', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        respostas: respostasArray
                    })
                });

                const result = await response.json();
                console.log('üìä Resultado recebido:', result);

                if (result.success) {
                    mostrarResultadoQuestionario(result);
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao enviar question√°rio:', error);
                alert('Erro ao enviar question√°rio. Tente novamente.');
            }
        }

        // FUN√á√ÉO CORRIGIDA: Mostrar resultado do question√°rio
        function mostrarResultadoQuestionario(result) {
            const quizResult = document.getElementById('quizResult');
            const nivelClass = result.diagnostico.nivel.toLowerCase().replace(' ', '-');
            
            quizResult.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h3>üìä Seu Resultado</h3>
                    <div style="font-size: 1.5rem; font-weight: bold; margin: 10px 0;">
                        Pontua√ß√£o: ${result.diagnostico.pontuacao}/30
                    </div>
                    <div class="nivel ${nivelClass}" style="font-size: 1.2rem; margin: 10px 0;">
                        ${result.diagnostico.nivel}
                    </div>
                    <div class="solucoes-list">
                        <h4>üí° Sugest√µes para voc√™:</h4>
                        ${result.solucoes.map(solucao => `
                            <div class="solucao-item">${solucao}</div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            quizResult.style.display = 'block';
            document.getElementById('submitQuiz').style.display = 'none';
            
            // Recarregar dados do dashboard ap√≥s 3 segundos
            setTimeout(() => {
                carregarDadosIniciais();
            }, 3000);
        }

        // ========== FUN√á√ïES DO SISTEMA FAMILIAR ==========

        // FUN√á√ÉO CORRIGIDA: Adicionar membro da fam√≠lia
        async function adicionarMembroFamilia() {
            const nome = document.getElementById('memberName').value;
            const idade = document.getElementById('memberAge').value;
            const relacionamento = document.getElementById('memberRelationship').value;
            
            if (!nome || !idade || !relacionamento) {
                alert('Por favor, preencha todos os campos.');
                return;
            }
            
            try {
                const response = await fetch('/api/familia/membros', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        nome: nome,
                        idade: parseInt(idade),
                        relacionamento: relacionamento
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('Membro adicionado com sucesso!');
                    document.getElementById('familyModal').style.display = 'none';
                    document.getElementById('familyForm').reset();
                    carregarDadosIniciais(); // Recarregar dados
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao adicionar membro:', error);
                alert('Erro ao adicionar membro. Tente novamente.');
            }
        }

        // FUN√á√ÉO CORRIGIDA: Excluir membro da fam√≠lia
        async function excluirMembroFamilia(membroId) {
            if (!confirm('Tem certeza que deseja excluir este membro da fam√≠lia?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/familia/membros/${membroId}`, {
                    method: 'DELETE'
                });

                const result = await response.json();

                if (result.success) {
                    alert('Membro exclu√≠do com sucesso!');
                    carregarDadosIniciais(); // Recarregar dados
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao excluir membro:', error);
                alert('Erro ao excluir membro. Tente novamente.');
            }
        }

        // FUN√á√ÉO CORRIGIDA: Abrir question√°rio para membro da fam√≠lia
        async function abrirQuestionarioFamiliar(membroId, membroNome) {
            currentMembroId = membroId;
            currentMembroNome = membroNome;
            
            console.log(`üìù Abrindo question√°rio para ${membroNome} (ID: ${membroId})`);
            
            try {
                const response = await fetch('/api/perguntas');
                if (!response.ok) {
                    throw new Error('Erro ao carregar perguntas');
                }
                
                perguntasCarregadas = await response.json();
                console.log('üìã Perguntas carregadas:', perguntasCarregadas);
                
                const familyQuizQuestions = document.getElementById('familyQuizQuestions');
                familyQuizQuestions.innerHTML = '';
                respostasAtuais = {};
                
                // Atualizar t√≠tulo
                document.getElementById('familyQuizTitle').textContent = `Question√°rio para ${membroNome}`;
                document.getElementById('familyQuizDescription').textContent = `Responda o question√°rio em nome de ${membroNome}.`;
                
                // Renderizar perguntas
                perguntasCarregadas.forEach((pergunta, index) => {
                    const perguntaDiv = document.createElement('div');
                    perguntaDiv.className = 'pergunta';
                    perguntaDiv.innerHTML = `
                        <div class="pergunta-texto">${index + 1}. ${pergunta.texto}</div>
                        <div class="opcoes-resposta" id="family-opcoes-${pergunta.id}">
                            ${pergunta.opcoes.map(opcao => `
                                <div class="opcao" data-pergunta="${pergunta.id}" data-opcao="${opcao.id}" data-pontuacao="${opcao.pontuacao}">
                                    ${opcao.texto}
                                </div>
                            `).join('')}
                        </div>
                    `;
                    familyQuizQuestions.appendChild(perguntaDiv);
                });
                
                // Adicionar eventos √†s op√ß√µes
                document.querySelectorAll('#familyQuizQuestions .opcao').forEach(opcao => {
                    opcao.addEventListener('click', function() {
                        const perguntaId = this.getAttribute('data-pergunta');
                        const opcaoId = this.getAttribute('data-opcao');
                        const pontuacao = parseInt(this.getAttribute('data-pontuacao'));
                        
                        // Remover sele√ß√£o anterior da mesma pergunta
                        document.querySelectorAll(`#familyQuizQuestions .opcao[data-pergunta="${perguntaId}"]`).forEach(op => {
                            op.classList.remove('selecionada');
                        });
                        
                        // Selecionar nova op√ß√£o
                        this.classList.add('selecionada');
                        
                        // Salvar resposta
                        respostasAtuais[perguntaId] = {
                            pergunta_id: perguntaId,
                            opcao_id: opcaoId,
                            pontuacao: pontuacao,
                            texto: this.textContent.trim()
                        };
                        
                        // Verificar se todas as perguntas foram respondidas
                        verificarRespostasFamiliaCompletas();
                    });
                });
                
                document.getElementById('submitFamilyQuiz').style.display = 'none';
                document.getElementById('familyQuizResult').style.display = 'none';
                document.getElementById('familyQuizModal').style.display = 'block';
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar question√°rio familiar:', error);
                alert('Erro ao carregar o question√°rio. Tente novamente.');
            }
        }

        // FUN√á√ÉO CORRIGIDA: Verificar respostas do question√°rio familiar
        function verificarRespostasFamiliaCompletas() {
            const todasRespondidas = perguntasCarregadas.every(pergunta => 
                respostasAtuais[pergunta.id] !== undefined
            );
            
            document.getElementById('submitFamilyQuiz').style.display = todasRespondidas ? 'block' : 'none';
        }

        // FUN√á√ÉO CORRIGIDA: Enviar question√°rio familiar
        async function enviarQuestionarioFamiliar() {
            console.log('üì§ Enviando question√°rio familiar...');
            
            const respostasArray = Object.values(respostasAtuais);
            
            try {
                const response = await fetch(`/api/familia/membros/${currentMembroId}/diagnostico`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        respostas: respostasArray
                    })
                });

                const result = await response.json();
                console.log('üìä Resultado familiar recebido:', result);

                if (result.success) {
                    mostrarResultadoQuestionarioFamiliar(result);
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                console.error('‚ùå Erro ao enviar question√°rio familiar:', error);
                alert('Erro ao enviar question√°rio. Tente novamente.');
            }
        }

        // FUN√á√ÉO CORRIGIDA: Mostrar resultado do question√°rio familiar
        function mostrarResultadoQuestionarioFamiliar(result) {
            const familyQuizResult = document.getElementById('familyQuizResult');
            const nivelClass = result.diagnostico.nivel.toLowerCase().replace(' ', '-');
            
            familyQuizResult.innerHTML = `
                <div style="text-align: center; padding: 20px;">
                    <h3>üìä Resultado para ${currentMembroNome}</h3>
                    <div style="font-size: 1.5rem; font-weight: bold; margin: 10px 0;">
                        Pontua√ß√£o: ${result.diagnostico.pontuacao}/30
                    </div>
                    <div class="nivel ${nivelClass}" style="font-size: 1.2rem; margin: 10px 0;">
                        ${result.diagnostico.nivel}
                    </div>
                    <div class="solucoes-list">
                        <h4>üí° Sugest√µes para ${currentMembroNome}:</h4>
                        ${result.solucoes.map(solucao => `
                            <div class="solucao-item">${solucao}</div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            familyQuizResult.style.display = 'block';
            document.getElementById('submitFamilyQuiz').style.display = 'none';
            
            // Recarregar dados do dashboard ap√≥s 3 segundos
            setTimeout(() => {
                carregarDadosIniciais();
            }, 3000);
        }

        // ========== FUN√á√ïES DO CENTRO DE RECURSOS ==========

        // FUN√á√ÉO CORRIGIDA: Dicas Personalizadas
        async function abrirDicasPersonalizadas() {
            currentResource = 'dicas';
            try {
                const response = await fetch('/api/dashboard-data');
                const data = await response.json();
                
                let dicasHTML = `<h3>üí° Dicas Personalizadas</h3>`;
                
                if (data.success && data.ultimo_diagnostico) {
                    const nivel = data.ultimo_diagnostico.nivel;
                    // CORRE√á√ÉO: Usar encodeURIComponent para garantir que o n√≠vel seja passado corretamente
                    const solucoesResponse = await fetch(`/api/solucoes/${encodeURIComponent(nivel)}`);
                    const solucoesData = await solucoesResponse.json();
                    
                    if (solucoesData.success) {
                        dicasHTML += `
                            <p>Baseado no seu √∫ltimo diagn√≥stico (<strong>${nivel}</strong>), aqui est√£o algumas dicas personalizadas:</p>
                            <div class="solucoes-list">
                                ${solucoesData.solucoes.map(solucao => `
                                    <div class="solucao-item">${solucao}</div>
                                `).join('')}
                            </div>
                        `;
                    } else {
                        dicasHTML += `<p>Erro ao carregar solu√ß√µes personalizadas.</p>`;
                    }
                } else {
                    dicasHTML += `
                        <p>Voc√™ ainda n√£o realizou nenhum diagn√≥stico. Complete o question√°rio para receber dicas personalizadas.</p>
                        <button class="btn" onclick="abrirQuestionario()">Fazer Question√°rio</button>
                    `;
                }
                
                document.getElementById('resourcesContent').innerHTML = dicasHTML;
                document.getElementById('resourcesModal').style.display = 'block';
                
            } catch (error) {
                console.error('Erro ao carregar dicas:', error);
                document.getElementById('resourcesContent').innerHTML = `
                    <h3>üí° Dicas Personalizadas</h3>
                    <p>Erro ao carregar dicas personalizadas. Tente novamente.</p>
                `;
                document.getElementById('resourcesModal').style.display = 'block';
            }
        }

        // FUN√á√ÉO REMOVIDA: Panorama da Fam√≠lia - n√£o √© mais necess√°rio

        // FUN√á√ÉO CORRIGIDA: Autoavalia√ß√£o e Reflex√£o
        async function abrirAutoavaliacao() {
            currentResource = 'autoavaliacao';
            
            // Carregar reflex√µes salvas
            let reflexao1 = '', reflexao2 = '', reflexao3 = '';
            
            try {
                const response = await fetch('/api/reflexoes');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.reflexoes) {
                        reflexao1 = data.reflexoes["Como voc√™ se sente sobre o tempo que passa online atualmente?"]?.resposta || '';
                        reflexao2 = data.reflexoes["Quais atividades offline voc√™ gostaria de fazer mais?"]?.resposta || '';
                        reflexao3 = data.reflexoes["Que mudan√ßas voc√™ gostaria de implementar no seu uso de tecnologia?"]?.resposta || '';
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar reflex√µes:', error);
            }
            
            const autoavaliacaoHTML = `
                <h3>üìù Autoavalia√ß√£o e Reflex√£o</h3>
                <p>Reflita sobre seu uso digital respondendo √†s seguintes perguntas:</p>
                
                <form id="reflexoesForm">
                    <div class="reflection-question">
                        <label>1. Como voc√™ se sente sobre o tempo que passa online atualmente?</label>
                        <textarea id="reflexao1" placeholder="Descreva seus sentimentos...">${reflexao1}</textarea>
                    </div>
                    
                    <div class="reflection-question">
                        <label>2. Quais atividades offline voc√™ gostaria de fazer mais?</label>
                        <textarea id="reflexao2" placeholder="Liste atividades que voc√™ gostaria de retomar...">${reflexao2}</textarea>
                    </div>
                    
                    <div class="reflection-question">
                        <label>3. Que mudan√ßas voc√™ gostaria de implementar no seu uso de tecnologia?</label>
                        <textarea id="reflexao3" placeholder="Descreva suas metas...">${reflexao3}</textarea>
                    </div>
                    
                    <button type="button" class="btn" onclick="salvarReflexoes()">Salvar Reflex√µes</button>
                </form>
            `;
            
            document.getElementById('resourcesContent').innerHTML = autoavaliacaoHTML;
            document.getElementById('resourcesModal').style.display = 'block';
        }

        // FUN√á√ÉO CORRIGIDA: Salvar Reflex√µes
        async function salvarReflexoes() {
            try {
                const reflexoes = {
                    "Como voc√™ se sente sobre o tempo que passa online atualmente?": document.getElementById('reflexao1').value,
                    "Quais atividades offline voc√™ gostaria de fazer mais?": document.getElementById('reflexao2').value,
                    "Que mudan√ßas voc√™ gostaria de implementar no seu uso de tecnologia?": document.getElementById('reflexao3').value
                };
                
                const response = await fetch('/api/reflexoes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        reflexoes: reflexoes
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('Reflex√µes salvas com sucesso!');
                    document.getElementById('resourcesModal').style.display = 'none';
                } else {
                    alert('Erro: ' + result.error);
                }
            } catch (error) {
                console.error('Erro ao salvar reflex√µes:', error);
                alert('Erro ao salvar reflex√µes. Tente novamente.');
            }
        }

        // FUN√á√ÉO CORRIGIDA: Plano de A√ß√£o Pessoal com persist√™ncia
        async function abrirPlanoAcao() {
            currentResource = 'planoacao';
            
            try {
                // Tentar carregar plano salvo da API
                const response = await fetch('/api/plano-acao');
                let planoSalvo = { metas: [], metasPersonalizadas: [] };
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.plano_acao) {
                        planoSalvo = data.plano_acao;
                        console.log('üìã Plano carregado da API:', planoSalvo);
                    }
                } else {
                    // Fallback: carregar do localStorage
                    planoSalvo = carregarPlanoLocal();
                }
                
                const planoAcaoHTML = `
                    <h3>‚úÖ Plano de A√ß√£o Pessoal</h3>
                    <p>Crie seu plano personalizado para melhorar seu bem-estar digital:</p>
                    
                    <!-- Estat√≠sticas do Plano -->
                    <div class="plano-stats" id="planoStats">
                        <div class="plano-stat">
                            <span class="plano-stat-value" id="totalMetas">0</span>
                            <span class="plano-stat-label">Total de Metas</span>
                        </div>
                        <div class="plano-stat">
                            <span class="plano-stat-value" id="metasConcluidas">0</span>
                            <span class="plano-stat-label">Conclu√≠das</span>
                        </div>
                        <div class="plano-stat">
                            <span class="plano-stat-value" id="progressoPercentual">0%</span>
                            <span class="plano-stat-label">Progresso</span>
                        </div>
                    </div>
                    
                    <div id="listaMetas">
                        <!-- Metas ser√£o carregadas aqui -->
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>‚ûï Adicionar Meta Personalizada</h4>
                        <input type="text" id="novaMeta" placeholder="Digite sua meta personalizada..." style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px;">
                        <button class="btn" onclick="adicionarMetaPersonalizada()">Adicionar Meta</button>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-success" onclick="salvarPlanoAcao()">üíæ Salvar Plano</button>
                        <button class="btn" onclick="limparPlanoAcao()" style="margin-left: 10px;">üóëÔ∏è Limpar Tudo</button>
                    </div>
                `;
                
                document.getElementById('resourcesContent').innerHTML = planoAcaoHTML;
                
                // Carregar metas iniciais
                carregarMetasIniciais(planoSalvo);
                document.getElementById('resourcesModal').style.display = 'block';
                
            } catch (error) {
                console.error('Erro ao carregar plano:', error);
                // Fallback para HTML b√°sico se a API falhar
                carregarPlanoBasico();
            }
        }

        // Carregar metas iniciais
        function carregarMetasIniciais(planoSalvo) {
            const metasPadrao = [
                { id: 'acao1', texto: 'Estabelecer hor√°rios espec√≠ficos para verificar redes sociais' },
                { id: 'acao2', texto: 'Criar zonas livres de dispositivos em casa' },
                { id: 'acao3', texto: 'Praticar a t√©cnica Pomodoro (25min foco, 5min pausa)' },
                { id: 'acao4', texto: 'Desativar notifica√ß√µes n√£o essenciais' },
                { id: 'acao5', texto: 'Estabelecer uma rotina de exerc√≠cios f√≠sicos' },
                { id: 'acao6', texto: 'Dedicar tempo para hobbies offline' }
            ];
            
            let html = '';
            
            // Metas padr√£o
            metasPadrao.forEach(meta => {
                const estaConcluida = planoSalvo.metas?.find(m => m.id === meta.id)?.concluida || false;
                html += `
                    <div class="action-item ${estaConcluida ? 'completed' : ''}">
                        <input type="checkbox" id="${meta.id}" ${estaConcluida ? 'checked' : ''} onchange="marcarMeta('${meta.id}', this.checked)">
                        <label for="${meta.id}">${meta.texto}</label>
                    </div>
                `;
            });
            
            // Metas personalizadas
            if (planoSalvo.metasPersonalizadas && planoSalvo.metasPersonalizadas.length > 0) {
                planoSalvo.metasPersonalizadas.forEach(meta => {
                    html += `
                        <div class="action-item ${meta.concluida ? 'completed' : ''}">
                            <input type="checkbox" id="${meta.id}" ${meta.concluida ? 'checked' : ''} onchange="marcarMeta('${meta.id}', this.checked)">
                            <label for="${meta.id}">${meta.texto}</label>
                            <button class="btn-excluir" onclick="removerMetaPersonalizada('${meta.id}')" style="margin-left: auto;">üóëÔ∏è</button>
                        </div>
                    `;
                });
            }
            
            document.getElementById('listaMetas').innerHTML = html;
            atualizarEstatisticasPlano();
        }

        // Fallback se a API n√£o estiver dispon√≠vel
        function carregarPlanoBasico() {
            const planoAcaoHTML = `
                <h3>‚úÖ Plano de A√ß√£o Pessoal</h3>
                <p>Crie seu plano personalizado para melhorar seu bem-estar digital:</p>
                
                <div class="plano-stats" id="planoStats">
                    <div class="plano-stat">
                        <span class="plano-stat-value" id="totalMetas">0</span>
                        <span class="plano-stat-label">Total de Metas</span>
                    </div>
                    <div class="plano-stat">
                        <span class="plano-stat-value" id="metasConcluidas">0</span>
                        <span class="plano-stat-label">Conclu√≠das</span>
                    </div>
                    <div class="plano-stat">
                        <span class="plano-stat-value" id="progressoPercentual">0%</span>
                        <span class="plano-stat-label">Progresso</span>
                    </div>
                </div>
                
                <div id="listaMetas">
                    <div class="action-item">
                        <input type="checkbox" id="acao1" onchange="marcarMeta('acao1', this.checked)">
                        <label for="acao1">Estabelecer hor√°rios espec√≠ficos para verificar redes sociais</label>
                    </div>
                    
                    <div class="action-item">
                        <input type="checkbox" id="acao2" onchange="marcarMeta('acao2', this.checked)">
                        <label for="acao2">Criar zonas livres de dispositivos em casa</label>
                    </div>
                    
                    <div class="action-item">
                        <input type="checkbox" id="acao3" onchange="marcarMeta('acao3', this.checked)">
                        <label for="acao3">Praticar a t√©cnica Pomodoro (25min foco, 5min pausa)</label>
                    </div>
                    
                    <div class="action-item">
                        <input type="checkbox" id="acao4" onchange="marcarMeta('acao4', this.checked)">
                        <label for="acao4">Desativar notifica√ß√µes n√£o essenciais</label>
                    </div>
                    
                    <div class="action-item">
                        <input type="checkbox" id="acao5" onchange="marcarMeta('acao5', this.checked)">
                        <label for="acao5">Estabelecer uma rotina de exerc√≠cios f√≠sicos</label>
                    </div>
                    
                    <div class="action-item">
                        <input type="checkbox" id="acao6" onchange="marcarMeta('acao6', this.checked)">
                        <label for="acao6">Dedicar tempo para hobbies offline</label>
                    </div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h4>‚ûï Adicionar Meta Personalizada</h4>
                    <input type="text" id="novaMeta" placeholder="Digite sua meta personalizada..." style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px;">
                    <button class="btn" onclick="adicionarMetaPersonalizada()">Adicionar Meta</button>
                </div>
                
                <div style="margin-top: 20px;">
                    <button class="btn btn-success" onclick="salvarPlanoLocal()">üíæ Salvar Localmente</button>
                    <button class="btn" onclick="limparPlanoAcao()" style="margin-left: 10px;">üóëÔ∏è Limpar Tudo</button>
                </div>
            `;
            
            document.getElementById('resourcesContent').innerHTML = planoAcaoHTML;
            atualizarEstatisticasPlano();
        }

        // FUN√á√ÉO CORRIGIDA: Adicionar meta personalizada
        function adicionarMetaPersonalizada() {
            const novaMetaTexto = document.getElementById('novaMeta').value.trim();
            if (!novaMetaTexto) {
                alert('Por favor, digite uma meta.');
                return;
            }
            
            const metaId = 'meta-' + Date.now();
            const novaMetaHTML = `
                <div class="action-item">
                    <input type="checkbox" id="${metaId}" onchange="marcarMeta('${metaId}', this.checked)">
                    <label for="${metaId}">${novaMetaTexto}</label>
                    <button class="btn-excluir" onclick="removerMetaPersonalizada('${metaId}')" style="margin-left: auto;">üóëÔ∏è</button>
                </div>
            `;
            
            document.getElementById('listaMetas').insertAdjacentHTML('beforeend', novaMetaHTML);
            document.getElementById('novaMeta').value = '';
            
            // Atualizar estat√≠sticas e salvar
            atualizarEstatisticasPlano();
            salvarPlanoAcao();
        }

        // Marcar/desmarcar meta
        function marcarMeta(metaId, concluida) {
            const actionItem = document.querySelector(`#${metaId}`).closest('.action-item');
            if (concluida) {
                actionItem.classList.add('completed');
            } else {
                actionItem.classList.remove('completed');
            }
            
            // Atualizar estat√≠sticas e salvar
            atualizarEstatisticasPlano();
            salvarPlanoAcao();
        }

        // Remover meta personalizada
        function removerMetaPersonalizada(metaId) {
            if (!confirm('Tem certeza que deseja remover esta meta?')) {
                return;
            }
            
            const actionItem = document.querySelector(`#${metaId}`).closest('.action-item');
            actionItem.remove();
            
            // Atualizar estat√≠sticas e salvar
            atualizarEstatisticasPlano();
            salvarPlanoAcao();
        }

        // Atualizar estat√≠sticas do plano
        function atualizarEstatisticasPlano() {
            const totalMetas = document.querySelectorAll('.action-item').length;
            const metasConcluidas = document.querySelectorAll('.action-item.completed').length;
            const progressoPercentual = totalMetas > 0 ? Math.round((metasConcluidas / totalMetas) * 100) : 0;
            
            if (document.getElementById('totalMetas')) {
                document.getElementById('totalMetas').textContent = totalMetas;
                document.getElementById('metasConcluidas').textContent = metasConcluidas;
                document.getElementById('progressoPercentual').textContent = progressoPercentual + '%';
            }
        }

        // FUN√á√ÉO CORRIGIDA: Salvar plano de a√ß√£o
        async function salvarPlanoAcao() {
            try {
                const metas = [];
                const metasPersonalizadas = [];
                
                // Coletar todas as metas
                document.querySelectorAll('.action-item').forEach(item => {
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    const label = item.querySelector('label');
                    const meta = {
                        id: checkbox.id,
                        texto: label.textContent,
                        concluida: checkbox.checked
                    };
                    
                    if (checkbox.id.startsWith('meta-')) {
                        metasPersonalizadas.push(meta);
                    } else {
                        metas.push(meta);
                    }
                });
                
                const planoData = {
                    metas: metas,
                    metasPersonalizadas: metasPersonalizadas,
                    dataAtualizacao: new Date().toISOString()
                };
                
                console.log('üíæ Salvando plano na API:', planoData);
                
                // CORRE√á√ÉO: Enviar com o nome correto do campo (plano_acao)
                const response = await fetch('/api/plano-acao', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plano_acao: planoData
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    mostrarFeedbackSucesso('Plano salvo com sucesso!');
                } else {
                    throw new Error(result.error);
                }
                
            } catch (error) {
                console.error('Erro ao salvar plano:', error);
                mostrarFeedbackErro('Erro ao salvar plano: ' + error.message);
            }
        }

        // Salvar localmente no localStorage (fallback)
        function salvarPlanoLocal() {
            try {
                const metas = [];
                const metasPersonalizadas = [];
                
                document.querySelectorAll('.action-item').forEach(item => {
                    const checkbox = item.querySelector('input[type="checkbox"]');
                    const label = item.querySelector('label');
                    const meta = {
                        id: checkbox.id,
                        texto: label.textContent,
                        concluida: checkbox.checked
                    };
                    
                    if (checkbox.id.startsWith('meta-')) {
                        metasPersonalizadas.push(meta);
                    } else {
                        metas.push(meta);
                    }
                });
                
                const planoData = {
                    metas: metas,
                    metasPersonalizadas: metasPersonalizadas,
                    dataAtualizacao: new Date().toISOString()
                };
                
                localStorage.setItem('planoAcaoPessoal', JSON.stringify(planoData));
                mostrarFeedbackSucesso('Plano salvo localmente!');
            } catch (error) {
                console.error('Erro ao salvar localmente:', error);
                alert('Erro ao salvar o plano.');
            }
        }

        // Carregar plano do localStorage (fallback)
        function carregarPlanoLocal() {
            try {
                const planoSalvo = localStorage.getItem('planoAcaoPessoal');
                return planoSalvo ? JSON.parse(planoSalvo) : { metas: [], metasPersonalizadas: [] };
            } catch (error) {
                console.error('Erro ao carregar plano local:', error);
                return { metas: [], metasPersonalizadas: [] };
            }
        }

        // Limpar plano de a√ß√£o
        function limparPlanoAcao() {
            if (!confirm('Tem certeza que deseja limpar todo o plano de a√ß√£o? Esta a√ß√£o n√£o pode ser desfeita.')) {
                return;
            }
            
            // Limpar localStorage
            localStorage.removeItem('planoAcaoPessoal');
            
            // Recarregar o plano vazio
            carregarPlanoBasico();
            
            mostrarFeedbackSucesso('Plano limpo com sucesso!');
        }

        // Mostrar feedback visual
        function mostrarFeedbackSucesso(mensagem) {
            // Criar ou atualizar elemento de feedback
            let feedbackEl = document.getElementById('planoFeedback');
            if (!feedbackEl) {
                feedbackEl = document.createElement('div');
                feedbackEl.id = 'planoFeedback';
                feedbackEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #4CAF50;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 5px;
                    z-index: 10000;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                `;
                document.body.appendChild(feedbackEl);
            }
            
            feedbackEl.textContent = mensagem;
            feedbackEl.style.display = 'block';
            
            setTimeout(() => {
                feedbackEl.style.display = 'none';
            }, 3000);
        }

        // NOVA FUN√á√ÉO: Mostrar feedback de erro
        function mostrarFeedbackErro(mensagem) {
            let feedbackEl = document.getElementById('planoFeedback');
            if (!feedbackEl) {
                feedbackEl = document.createElement('div');
                feedbackEl.id = 'planoFeedback';
                feedbackEl.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #dc3545;
                    color: white;
                    padding: 10px 20px;
                    border-radius: 5px;
                    z-index: 10000;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
                `;
                document.body.appendChild(feedbackEl);
            }
            
            feedbackEl.textContent = mensagem;
            feedbackEl.style.display = 'block';
            
            setTimeout(() => {
                feedbackEl.style.display = 'none';
            }, 5000);
        }

        // ========== FUN√á√ïES DE INSTITUI√á√ïES ==========

        // FUN√á√ÉO CORRIGIDA: Abrir modal de institui√ß√µes
        async function abrirInstituicoes() {
            console.log('üîÑ Abrindo modal de institui√ß√µes...');
            
            // Mostrar modal imediatamente
            document.getElementById('instituicoesModal').style.display = 'block';
            
            // Mostrar loading
            const instituicoesLista = document.getElementById('instituicoesLista');
            instituicoesLista.innerHTML = `
                <div class="sem-instituicoes">
                    <div class="loading"></div>
                    <p>Carregando institui√ß√µes...</p>
                </div>
            `;

            try {
                console.log('üîÑ Carregando institui√ß√µes da API...');
                // CORRE√á√ÉO: Usar a API correta que retorna institui√ß√µes com profissionais
                const response = await fetch('/api/instituicoes-com-profissionais');
                
                if (!response.ok) {
                    throw new Error(`Erro HTTP: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üè• Dados completos recebidos:', data);
                
                // Agora passamos o objeto completo para a fun√ß√£o de exibi√ß√£o
                exibirInstituicoesComProfissionais(data);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar institui√ß√µes:', error);
                document.getElementById('instituicoesLista').innerHTML = `
                    <div class="sem-instituicoes">
                        <h3>‚ùå Erro ao carregar institui√ß√µes</h3>
                        <p>N√£o foi poss√≠vel carregar a lista de institui√ß√µes no momento.</p>
                        <p>Erro: ${error.message}</p>
                        <button class="btn" onclick="abrirInstituicoes()" style="margin-top: 1rem;">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
            }
        }

        // NOVA FUN√á√ÉO: Exibir institui√ß√µes com profissionais
        function exibirInstituicoesComProfissionais(data) {
            const instituicoesLista = document.getElementById('instituicoesLista');
            const instituicoesAlert = document.getElementById('instituicoesAlert');
            
            console.log("üìä Dados recebidos para exibi√ß√£o:", data);
            
            // Limpar alertas
            instituicoesAlert.innerHTML = '';
            
            // Verificar se a resposta da API foi bem sucedida
            if (!data || !data.success) {
                instituicoesLista.innerHTML = `
                    <div class="sem-instituicoes">
                        <h3>‚ùå Erro ao carregar institui√ß√µes</h3>
                        <p>${data?.error || 'Erro desconhecido ao carregar dados'}</p>
                        <button class="btn" onclick="abrirInstituicoes()" style="margin-top: 1rem;">
                            üîÑ Tentar Novamente
                        </button>
                    </div>
                `;
                return;
            }
            
            const instituicoes = data.instituicoes;
            
            if (!instituicoes || instituicoes.length === 0) {
                instituicoesLista.innerHTML = `
                    <div class="sem-instituicoes">
                        <h3>üè• Nenhuma institui√ß√£o cadastrada</h3>
                        <p>No momento n√£o h√° institui√ß√µes de apoio dispon√≠veis.</p>
                        <p>As institui√ß√µes podem ser cadastradas na p√°gina inicial.</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            instituicoes.forEach(instituicao => {
                console.log("üè• Processando institui√ß√£o:", instituicao);
                
                let profissionaisHTML = '';
                
                if (instituicao.profissionais && instituicao.profissionais.length > 0) {
                    instituicao.profissionais.forEach(profissional => {
                        profissionaisHTML += `
                            <div class="profissional-item">
                                <div class="profissional-nome">${profissional.nome || 'Nome n√£o informado'}</div>
                                <div class="profissao">${profissional.profissao || 'Profiss√£o n√£o informada'} - ${profissional.especialidade || 'Especialidade n√£o informada'}</div>
                                ${profissional.registro_profissional ? `<div style="font-size: 0.8rem; color: #666;">Registro: ${profissional.registro_profissional}</div>` : ''}
                                ${profissional.abordagem ? `<div style="font-size: 0.8rem; color: #666;">Abordagem: ${profissional.abordagem}</div>` : ''}
                                ${profissional.telefone ? `<div style="font-size: 0.8rem; color: #666;">üìû ${profissional.telefone}</div>` : ''}
                                ${profissional.email ? `<div style="font-size: 0.8rem; color: #666;">‚úâÔ∏è ${profissional.email}</div>` : ''}
                            </div>
                        `;
                    });
                } else {
                    profissionaisHTML = '<p style="color: #666; font-style: italic; padding: 1rem;">Nenhum profissional cadastrado nesta institui√ß√£o</p>';
                }
                
                html += `
                    <div class="instituicao-card">
                        <div class="instituicao-nome">${instituicao.nome || 'Institui√ß√£o sem nome'}</div>
                        <div style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">${instituicao.tipo || 'Tipo n√£o informado'}</div>
                        
                        <div style="margin-bottom: 1rem;">
                            <strong>üë®‚Äç‚öïÔ∏è Profissionais:</strong>
                            ${profissionaisHTML}
                        </div>
                        
                        <div class="instituicao-info">
                            ${instituicao.endereco ? `<div class="info-item"><i>üìç</i> ${instituicao.endereco}</div>` : ''}
                            ${instituicao.telefone ? `<div class="info-item"><i>üìû</i> ${instituicao.telefone}</div>` : ''}
                            ${instituicao.email ? `<div class="info-item"><i>‚úâÔ∏è</i> ${instituicao.email}</div>` : ''}
                            ${instituicao.descricao ? `<div class="info-item"><i>üìù</i> ${instituicao.descricao}</div>` : ''}
                            ${instituicao.especialidades ? `<div class="info-item"><i>üéØ</i> ${instituicao.especialidades}</div>` : ''}
                        </div>
                    </div>
                `;
            });
            
            instituicoesLista.innerHTML = html;
            
            // Mostrar mensagem de sucesso
            instituicoesAlert.innerHTML = `
                <div class="alert alert-success">
                    ‚úÖ ${instituicoes.length} institui√ß√£o(√µes) carregada(s) com sucesso!
                </div>
            `;
            
            console.log("‚úÖ Institui√ß√µes exibidas com sucesso!");
        }

        // ========== FUN√á√ïES DO DASHBOARD ==========

        async function carregarDadosIniciais() {
            try {
                console.log('üîÑ Carregando dados iniciais...');
                const response = await fetch('/api/dashboard-data');
                if (response.ok) {
                    const data = await response.json();
                    console.log('üìä Dados recebidos:', data);
                    if (data.success) {
                        atualizarInterface(data.usuario, data.ultimo_diagnostico, data.historico, data.familia_data, data.dica_do_dia, data.precisa_reavaliar);
                    } else {
                        throw new Error(data.error);
                    }
                } else {
                    throw new Error('Erro ao carregar dados');
                }
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                carregarDadosBasicos();
            }
        }

        function atualizarInterface(usuario, ultimoDiagnostico, historico, familiaData, dicaDoDia, precisaReavaliar) {
            // Atualizar nome do usu√°rio
            document.getElementById('userName').textContent = usuario.nome;
            
            // Atualizar perfil do usu√°rio
            const profileInfo = document.getElementById('profileInfo');
            let profileHTML = `
                <div class="profile-item">
                    <strong>Nome</strong>
                    <div>${usuario.nome}</div>
                </div>
                <div class="profile-item">
                    <strong>Idade</strong>
                    <div>${usuario.idade} anos</div>
                </div>
                <div class="profile-item">
                    <strong>Email</strong>
                    <div>${usuario.email}</div>
                </div>
            `;
            
            if (ultimoDiagnostico) {
                const nivelClass = ultimoDiagnostico.nivel.toLowerCase().replace(' ', '-');
                profileHTML += `
                    <div class="profile-item">
                        <strong>√öltimo Diagn√≥stico</strong>
                        <div>Pontua√ß√£o: ${ultimoDiagnostico.pontuacao}/30</div>
                        <div class="nivel ${nivelClass}">${ultimoDiagnostico.nivel}</div>
                    </div>
                `;
            } else {
                profileHTML += `
                    <div class="profile-item">
                        <strong>Diagn√≥stico</strong>
                        <div>Nenhum diagn√≥stico realizado</div>
                    </div>
                `;
            }
            
            profileInfo.innerHTML = profileHTML;
            
            // Atualizar resumo familiar
            atualizarResumoFamiliar(familiaData);
            
            // Atualizar gr√°fico se houver hist√≥rico
            if (historico && historico.length > 0) {
                atualizarGrafico(historico);
            }
            
            // Mostrar alerta de reavalia√ß√£o se necess√°rio
            if (precisaReavaliar) {
                const cardQuestionario = document.querySelector('.card:first-child');
                const alerta = document.createElement('div');
                alerta.className = 'reavaliacao-alerta';
                alerta.innerHTML = 'üìÖ Est√° na hora de fazer uma nova avalia√ß√£o! Sua √∫ltima avalia√ß√£o j√° tem mais de 30 dias.';
                cardQuestionario.appendChild(alerta);
            }
        }

        function atualizarResumoFamiliar(familiaData) {
            const familySummary = document.getElementById('familySummary');
            
            if (!familiaData || familiaData.total_membros === 0) {
                familySummary.innerHTML = `
                    <p>Nenhum membro da fam√≠lia cadastrado ainda.</p>
                    <p>Adicione membros da fam√≠lia para acompanhar o progresso de todos.</p>
                `;
                return;
            }
            
            let familyHTML = `
                <div class="family-stats">
                    <div class="stat-item">
                        <span class="stat-value">${familiaData.total_membros}</span>
                        <span class="stat-label">Membros</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${familiaData.media_pontuacao}</span>
                        <span class="stat-label">Pontua√ß√£o M√©dia</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value">${familiaData.nivel_predominante}</span>
                        <span class="stat-label">N√≠vel Predominante</span>
                    </div>
                </div>
                <div class="family-members">
            `;
            
            familiaData.membros.forEach(membro => {
                // CORRE√á√ÉO: Remover "null" da idade nos membros da fam√≠lia
                const idadeDisplay = membro.idade && membro.idade !== 'null' ? `${membro.idade} anos` : 'Idade n√£o informada';
                const nivelClass = membro.nivel ? membro.nivel.toLowerCase().replace(' ', '-') : 'sem-diagnostico';
                const nivelDisplay = membro.nivel || 'N√£o avaliado';
                const pontuacaoDisplay = membro.pontuacao || '--';
                
                familyHTML += `
                    <div class="family-member">
                        <strong>${membro.nome}</strong>
                        <div>${idadeDisplay} - ${membro.relacionamento}</div>
                        <div>Pontua√ß√£o: ${pontuacaoDisplay}/30</div>
                        <div class="nivel ${nivelClass}">${nivelDisplay}</div>
                        <div class="botoes-membro">
                            <button class="btn-questionario" onclick="abrirQuestionarioFamiliar(${membro.id}, '${membro.nome}')">
                                üìù Question√°rio
                            </button>
                            <button class="btn-excluir" onclick="excluirMembroFamilia(${membro.id})">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                `;
            });
            
            familyHTML += '</div>';
            familySummary.innerHTML = familyHTML;
        }

        function atualizarGrafico(historico) {
            const ctx = document.getElementById('chartCanvas').getContext('2d');
            
            // Destruir inst√¢ncia anterior do gr√°fico se existir
            if (chartInstance) {
                chartInstance.destroy();
            }
            
            const labels = historico.map((item, index) => `Avalia√ß√£o ${index + 1}`);
            const data = historico.map(item => item.pontuacao);
            const niveis = historico.map(item => item.nivel);
            
            // Cores baseadas no n√≠vel
            const cores = niveis.map(nivel => {
                switch(nivel) {
                    case 'Dependente': return '#ff6b6b';
                    case 'Moderado': return '#ffa726';
                    case 'N√£o dependente': return '#4caf50';
                    default: return '#4a6baf';
                }
            });
            
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pontua√ß√£o do Question√°rio',
                        data: data,
                        borderColor: '#4a6baf',
                        backgroundColor: 'rgba(74, 107, 175, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: cores,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 30,
                            title: {
                                display: true,
                                text: 'Pontua√ß√£o'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Avalia√ß√µes'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    return `N√≠vel: ${niveis[index]}`;
                                }
                            }
                        }
                    }
                }
            });
        }

        function carregarDadosBasicos() {
            document.getElementById('userName').textContent = 'Usu√°rio';
            document.getElementById('profileInfo').innerHTML = `
                <div class="profile-item">
                    <strong>Status</strong>
                    <div>Carregando dados...</div>
                </div>
            `;
            document.getElementById('familySummary').innerHTML = `
                <p>Carregando dados da fam√≠lia...</p>
            `;
        }

        console.log('üöÄ NETENDENCIA - Dashboard carregado com sucesso!');
    </script>
</body>
</html>